{% comment %}
  Simple path-based breadcrumbs
{% endcomment %}

{% assign base = site.baseurl | default: '' %}
{% if base == '/' %}{% assign base = '' %}{% endif %}

{% assign url = page.url %}
{% if url == nil or url == '' %}
  {% if page.permalink %}
    {% assign url = page.permalink %}
  {% elsif page.path %}
    {% assign url = page.path %}
  {% else %}
    {% assign url = '/' %}
  {% endif %}
{% endif %}

{% if url contains '://' %}
  {% assign url = url | replace: 'http://', '' | replace: 'https://', '' %}
  {% if site.url %}{% assign url = url | remove: site.url %}{% endif %}
  {% if base != '' %}{% assign url = url | remove: base %}{% endif %}
  {% assign url = '/' | append: url %}
{% endif %}

{% assign url = url | replace: 'index.html','' | replace: 'index.htm','' | replace: 'index.md','' %}
{% assign url = url | replace: '.html','' | replace: '.md','' %}
{% assign url = url | replace: '//' , '/' %}
{% unless url | slice: 0, 1 == '/' %}
  {% assign url = '/' | append: url %}
{% endunless %}

{% assign raw_segments = url | split:'/' %}
{% assign segments = "" | split:"" %}
{% for s in raw_segments %}
  {% assign s = s | strip %}
  {% if s != "" and s != "nil" %}
    {% assign segments = segments | push: s %}
  {% endif %}
{% endfor %}

<nav class="breadcrumbs" aria-label="Breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
  <ol>
    <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
      {% assign home_href = base | append:'/' | replace:'//','/' %}
      <a href="{{ home_href }}" itemprop="item"><span itemprop="name">Home</span></a>
      <meta itemprop="position" content="1" />
    </li>

    {% assign path = base %}
    {% for segment in segments %}
      {% assign path = path | append:'/' | append: segment | replace:'//','/' %}

      {%- comment -%}
        Build a display name: convert hyphens/underscores/%20 to spaces, collapse empty parts,
        and capitalize each word (so "Collin-County" -> "Collin County").
      {%- endcomment -%}
      {% capture name %}
        {% assign display_segment = segment | replace:'-',' ' | replace:'_',' ' | replace:'%20',' ' | strip %}
        {% assign words = display_segment | split:' ' %}
        {% assign printed = 0 %}
        {% for w in words %}
          {% assign w = w | strip %}
          {% if w != '' %}
            {% if printed > 0 %} {% endif %}{{ w | capitalize }}
            {% assign printed = printed | plus: 1 %}
          {% endif %}
        {% endfor %}
      {% endcapture %}
      {% assign position = forloop.index | plus: 1 %}

      {% if forloop.last %}
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem" aria-current="page">
          <span itemprop="name">{{ name }}</span>
          <meta itemprop="position" content="{{ position }}" />
        </li>
      {% else %}
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="{{ path | append:'/' | replace:'//','/' }}" itemprop="item"><span itemprop="name">{{ name }}</span></a>
          <meta itemprop="position" content="{{ position }}" />
        </li>
      {% endif %}
    {% endfor %}
  </ol>
</nav>
